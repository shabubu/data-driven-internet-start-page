<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title></title>

    <script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <script src="https://unpkg.com/create-react-class@15.6.0-rc.0/create-react-class.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="./data.js"></script>

    <link href="style.css" rel="stylesheet" type="text/css">
  </head>

  <body>
    <div id="ddisp"></div>

    <script type="text/babel">
      const Timezones = createReactClass({
        getInitialState() {
          this.interval = setInterval(
            () => {
              this.setState({
                date: new Date(),
              });
            },
            500,
          );

          return {
            date: new Date(),
          };
        },

        render() {
          const {
            time: {
              locale = 'en-US',
              zones = [],
            },
          } = appData;
          const { date } = this.state;
          const timezonesJsx = [];

          zones.forEach((timezone) => {
            const timeOptions = {
              timeZone: timezone.region,
              hour: '2-digit',
              minute: '2-digit',
            };
            const dateOptions = {
              timeZone: timezone.region,
              weekday: "short",
              year: 'numeric',
              month: 'short',
              day: '2-digit',
            };

            timezonesJsx.push(
              <li className="timezone-display">
                <h1>{timezone.title}</h1>
                <span>{date.toLocaleString(locale, timeOptions)}</span>
                <span>{date.toLocaleString(locale, dateOptions)}</span>
              </li>
            );
          });

          return (
            <div id="timezone-wrapper">
              <ul>
                {timezonesJsx}
              </ul>
            </div>
          );
        }
      });

      function Logo() {
        const { logo } = appData;
        let innerJsx;

        if (logo) {
          innerJsx = (
            <img
              id="logo"
              src={appData.logo}
            />
          );
        }

        return (
          <div id="logo-wrapper">
            {innerJsx}
          </div>
        );
      }

      function LinkGroup() {
        return (
          <div className="link-group">
            <span>Links</span>
            <ul>
              <li><a href="https://reddit.com">Reddit</a></li>
            </ul>
          </div>
        );
      }

      const QuoteOfDay = createReactClass({
        getInitialState() {
          return {
            author: '',
            quote: '',
          };
        },

        componentDidMount() {
          const self = this;
          if (appData.quoteOfTheDay) {
            axios
              .get('http://quotes.rest/qod.json')
              .then(response => {
                const {
                  data: {
                    contents: {
                      quotes: [
                        {
                          author,
                          quote,
                        },
                      ],
                    },
                  },
                } = response;

                if (
                        author
                        && quote
                ) {
                  self.setState({
                    author,
                    quote,
                  });
                }
              });
          }
        },

        render() {
          return (
            <div id="quote-of-day">
              <table>
                <tbody>
                  <tr>
                    <td>"{this.state.quote}"</td>
                    <td> - {this.state.author}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          );
        }
      });

      function App() {
        return (
          <div>
            <Timezones />
            <Logo />
            <LinkGroup />
            <QuoteOfDay />
          </div>
        );
      }

      const {
        title,
        background,
        favicon,
      } = appData;

      if (title) {
        document.title = title;
      }
      if (background) {
        document.body.style.background = background;
      }

      if (favicon) {
        const faviconElement = document.createElement('link');
        faviconElement.type = 'image/x-icon';
        faviconElement.rel = 'shortcut icon';
        faviconElement.href = favicon;
        document.getElementsByTagName('head')[0].appendChild(faviconElement);
      }

      ReactDOM.render(
        App(),
        document.getElementById('ddisp'),
      );

    </script>
  </body>
</html>

